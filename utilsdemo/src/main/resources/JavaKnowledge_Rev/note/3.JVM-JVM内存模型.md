# JVM 内存模型

了解 JVM 内存分布吗，介绍一下。

JVM 运行是会将自己管理的内存分为若干个区域，如图所示：

![](/Users/azh/Dev_AZH/Java_St/JUC/jvm/src/main/resources/photo/4.JVM内存结构.png)

## 线程共享区域与线程非共享区域

可以从线程的角度对这些区域进行区分。如：可以将 JVM 的运行时数据区分为两大类：

> 线程共享区域，和线程非共享区域。

### 线程共享区域

线程共享的区域有：堆、方法区；

#### 堆

堆是在 JVM 启动时就会分配的一块内存区域，主要用来存放程序运行期间产生的实例以及数组等数据。因此这块区域也可以称之为”堆内存“；

堆的内存可以是不连续的空间。堆的大小可以固定，也可以通过参数调整。参数如下：

> -Xms20M：设置 JVM启动时的最小值为20M。
>
> -Xmx20M ：设置JVM堆的最大值为20M。
>
> 一般来说会将堆的最小值和最大值调整为一样，这样是为了避免频繁地扩容，从而影响程序性能。

#### 方法区：

方法区具体存放的数据信息包含：用于存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等。

和方法区一样可以通过参数控制空间大小：

> JDK 1.8 及之后
>
> -XX:MetaspaceSize=N：元空间初始值大小。
>
> -XX:MaxMetaspaceSize=N：元空间最大上限值；不指定。默认 -1，表示无穷大，只受限于物理内存。

方法区在逻辑上是归属于堆的一部分，但是具体的落实却是一块独立的空间。因此方法区属于“非堆内存”。

> 在 JDK 1.7 及之前，方法区的实现是在永久代中(只限于HotSpot虚拟机)实现，这个永久代是在 JVM 管理的内存中单独划分了一块儿空间；
>
> 在 JDK 1. 8 及之后，方法区的实现从 JVM 管理的内存中转移到了物理内存之中，这个空间叫元空间；
>
> 为什么废弃永久代：是因为永久代设置空间大小是很难确定的，比如在某些场景下，动态类比较多的话，容易产生Perm区的oom。而元空间与永久代最大的区别就是元空间使用的是本地内存，只会受到本地物理内存的限制。
