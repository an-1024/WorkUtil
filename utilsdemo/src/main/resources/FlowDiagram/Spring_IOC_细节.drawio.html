<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>diagrams.net</title>
<meta http-equiv="refresh" content="0;URL='https://app.diagrams.net/#Han-1024%2FWorkUtil%2Fmaster%2Futilsdemo%2Fsrc%2Fmain%2Fresources%2FFlowDiagram%2FSpring_IOC_%E7%BB%86%E8%8A%82.drawio.html'"/>
<meta charset="utf-8"/>
</head>
<body>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-02-03T08:03:38.408Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36\&quot; etag=\&quot;pvLpXuIj9mRylQH1-Hke\&quot; version=\&quot;20.8.15\&quot; type=\&quot;github\&quot;&gt;&lt;diagram id=\&quot;C5RBs43oDa-KdzZeNtuy\&quot; name=\&quot;Page-1\&quot;&gt;&lt;mxGraphModel dx=\&quot;21585\&quot; dy=\&quot;2814\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;&lt;root&gt;&lt;mxCell id=\&quot;WIyWlLk6GJQsqaUBKTNV-0\&quot;/&gt;&lt;mxCell id=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-0\&quot;/&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-78\&quot; value=\&quot;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=18;fontColor=#00CCCC;strokeColor=#00CCCC;fillColor=#00CCCC;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-613\&quot; y=\&quot;-1300\&quot; width=\&quot;960\&quot; height=\&quot;750\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-72\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-0\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-5\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-0\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Spring IOC 细节-&amp;amp;gt; XML的bean加载&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-363\&quot; y=\&quot;-1239\&quot; width=\&quot;420\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-9\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-5\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-8\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-5\&quot; value=\&quot;ClassPathXmlApplicationContext(&amp;quot;classpath:spring-config.xml&amp;quot;)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;指定加载文件位置\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-527.5\&quot; y=\&quot;-1120\&quot; width=\&quot;749\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-8\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-8\&quot; value=\&quot;super(parent); 父级的层层调用，初始化 Spring Factory的属性值\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-538.75\&quot; y=\&quot;-980\&quot; width=\&quot;771.5\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-13\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-10\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-12\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-17\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-10\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-12\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-10\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ff3333&amp;quot;&amp;gt;&amp;lt;b&amp;gt;AbstractXmlApplicationContext&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;b style=&amp;quot;color: rgb(255, 51, 51); font-size: 25px;&amp;quot;&amp;gt;validating = true // XML 文档是否需要校验&amp;lt;/b&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;b style=&amp;quot;&amp;quot;&amp;gt;super(parent)&amp;lt;/b&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;align=left;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;460\&quot; y=\&quot;-1032.5\&quot; width=\&quot;490\&quot; height=\&quot;215\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-16\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-12\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-15\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-12\&quot; value=\&quot;&amp;lt;b&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(255, 51, 51); background-color: initial;&amp;quot;&amp;gt;AbstractRefreshableConfigApplicationContext&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff3333&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String[] configLocations 配置文件路径&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;setIdCalled = false 是否重新设置 bean 名称 ：fasle表示可以， true 表示不能自定义&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;super(parent)&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;align=left;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1100\&quot; y=\&quot;-1023.12\&quot; width=\&quot;1030\&quot; height=\&quot;196.25\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-19\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-15\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-18\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-15\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;AbstractRefreshableApplicationContext&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;Boolean allowBeanDefinitionOverriding是否允许 beanDefinition 定义被覆盖&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;Boolean allowCircularReferences 允许循环引用&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;DefaultListableBeanFactory beanFactory ：beanFactory 工厂定义&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;super(parent)&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;align=left;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2250\&quot; y=\&quot;-1049.99\&quot; width=\&quot;940\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-4\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#CC00CC;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-18\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-3\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-6\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#CC00CC;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vhB5iVHmFAJZdGOzhbKn-18\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-5\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vhB5iVHmFAJZdGOzhbKn-18\&quot; value=\&quot;&amp;lt;br&amp;gt;&amp;lt;b style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;AbstractApplicationContext&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String MESSAGE_SOURCE_BEAN_NAME = &amp;quot;messageSource&amp;quot; 消息解析器， 未指定加载父类的消息解析器&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String LIFECYCLE_PROCESSOR_BEAN_NAME = &amp;quot;lifecycleProcessor&amp;quot; 生命周期处理器，为提供默认使用DefaultLifecycleProcessor&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String APPLICATION_EVENT_MULTICASTER_BEAN_NAME = &amp;quot;applicationEventMulticaster&amp;quot; 应用事件广播，未指定默认使用SimpleApplicationEventMulticaster&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String id = ObjectUtils.identityToString(this) 应用id 赋值&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String displayName = ObjectUtils.identityToString(this) 显示名称赋值&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ApplicationContext parent 父类上下文&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff3333&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ConfigurableEnvironment environment 应用执行环境&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final List&amp;amp;lt;BeanFactoryPostProcessor&amp;amp;gt; beanFactoryPostProcessors = new ArrayList&amp;amp;lt;&amp;amp;gt;() 实例化前置处理器集合&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;long startupDate 应用开始启动时间&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final AtomicBoolean active = new AtomicBoolean() 应用是否正在运行&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final AtomicBoolean closed = new AtomicBoolean() 应用是否已经关闭&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Object startupShutdownMonitor = new Object() 刷新和销毁的同步监视器&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Thread shutdownHook&amp;amp;nbsp; 如果已经注册JVM钩子函数，那么该变量就是JVM 钩子函数的引用&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff3333&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ResourcePatternResolver resourcePatternResolver; 资源解析器 在&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;font color=&amp;quot;#ff3333&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;AbstractApplicationContext 构造函数中实现赋值&amp;amp;nbsp;this.resourceLoader =&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;b style=&amp;quot;color: rgb(255, 51, 51);&amp;quot;&amp;gt;AbstractApplicationContext&amp;lt;/b&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;LifecycleProcessor lifecycleProcessor; 生命周期处理器&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;MessageSource messageSource 国际化的实现&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ApplicationEventMulticaster applicationEventMulticaster; 管理许多 {@link ApplicationListener} 对象并向它们发布事件的对象实现的接口。&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Set&amp;amp;lt;ApplicationListener&amp;amp;lt;?&amp;amp;gt;&amp;amp;gt; applicationListeners = new LinkedHashSet&amp;amp;lt;&amp;amp;gt;(); 应用程序实现的监听程序的接口&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Set&amp;amp;lt;ApplicationListener&amp;amp;lt;?&amp;amp;gt;&amp;amp;gt; earlyApplicationListeners; 本地监听器的注册&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Set&amp;amp;lt;ApplicationEvent&amp;amp;gt; earlyApplicationEvents 应用程序所有时间扩展类&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#cc00cc&amp;quot;&amp;gt;this() 调用自己的构造方法&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;setParent(parent);&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3390\&quot; y=\&quot;-1369.99\&quot; width=\&quot;1603.44\&quot; height=\&quot;890\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-0\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-4\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-32\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-0\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-31\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-14\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-78\&quot; target=\&quot;vhB5iVHmFAJZdGOzhbKn-10\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-0\&quot; value=\&quot;设置&amp;amp;nbsp;&amp;lt;span style=&amp;quot;text-align: left; font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-weight: bold; font-size: 25px;&amp;quot; color=&amp;quot;#ff3333&amp;quot;&amp;gt;configLocations 的值&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;text-align: left; font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; text-align: center; font-size: 25px;&amp;quot;&amp;gt;setConfigLocations(configLocations)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/span&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-402.25\&quot; y=\&quot;-825\&quot; width=\&quot;498.5\&quot; height=\&quot;95\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-7\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-4\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-6\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-15\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-4\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-26\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-4\&quot; value=\&quot;resolvePath(locations[i])&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#e06d0d&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getEnvironment() 获取当前系统环境变量 environment 变量在这里完成了赋值&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getEnvironment().resolveRequiredPlaceholders(path) 创建资源加载器解析资源所在路径&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;align=left;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-2020\&quot; y=\&quot;-864.37\&quot; width=\&quot;1060\&quot; height=\&quot;173.75\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-9\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-6\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-8\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-8\&quot; value=\&quot;AbstractEnvironment&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final String IGNORE_GETENV_PROPERTY_NAME = &amp;quot;spring.getenv.ignore&amp;quot; 系统环境需要忽略的属性&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final String ACTIVE_PROFILES_PROPERTY_NAME = &amp;quot;spring.profiles.active&amp;quot;&amp;amp;nbsp;设置以指定活动配置文件的属性名称&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final String RESERVED_DEFAULT_PROFILE_NAME = &amp;quot;default&amp;quot;;&amp;amp;nbsp; &amp;amp;nbsp;默认配置文件名称的名称&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final MutablePropertySources propertySources = new MutablePropertySources()&amp;amp;nbsp; 属性配置类 -&amp;amp;gt; 父类构造函数中调用了&amp;amp;nbsp;customizePropertySources(this.propertySources) 来初始化该变量，具体实现子类的重写方法中(同样我们也可以指定 系统(System) 或者 JVM 需要加载的属性)&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#EF8707;strokeColor=#666666;fontColor=#333333;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-3260\&quot; y=\&quot;-1470\&quot; width=\&quot;1160\&quot; height=\&quot;391\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-16\&quot; value=\&quot;\&quot; style=\&quot;group;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-3205\&quot; y=\&quot;-927.5\&quot; width=\&quot;1050\&quot; height=\&quot;300\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-6\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;createEnvironment -&amp;amp;gt; new StandardEnvironment()&amp;lt;br style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final String SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME = &amp;quot;systemEnvironment&amp;quot; 系统环境变量属性&amp;lt;br style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final String SYSTEM_PROPERTIES_PROPERTY_SOURCE_NAME = &amp;quot;systemProperties&amp;quot; JVM 环境变量属&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#EF8707;strokeColor=#666666;rounded=0;fontColor=#333333;horizontal=1;verticalAlign=top;fontSize=18;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-16\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry width=\&quot;1050\&quot; height=\&quot;300.00000000000006\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-15\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;customizePropertySources(MutablePropertySources propertySources)&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=25;fontColor=#FFFF00;strokeColor=#EF8707;fillColor=#FFFF00;align=left;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-16\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;16.153846153846153\&quot; y=\&quot;207.69230769230776\&quot; width=\&quot;1017.6923076923076\&quot; height=\&quot;69.23076923076924\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-26\&quot; value=\&quot;doResolvePlaceholders(String text, PropertyPlaceholderHelper helper)实现对了资源路径的解析\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-2030\&quot; y=\&quot;-1160\&quot; width=\&quot;1080\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-36\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-31\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-35\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-39\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left; font-size: 18px;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Verdana;fontColor=#000000;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-36\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;0.007\&quot; y=\&quot;2\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;128\&quot; y=\&quot;-8\&quot; as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-11\&quot; value=\&quot;&amp;lt;div style=&amp;quot;font-family: Verdana; font-size: 18px; text-align: left;&amp;quot;&amp;gt;给 Spring&amp;lt;/div&amp;gt;&amp;lt;span style=&amp;quot;font-family: Verdana; font-size: 18px;&amp;quot;&amp;gt;一些基础属性&amp;lt;/span&amp;gt;&amp;lt;br style=&amp;quot;font-family: Verdana; font-size: 18px;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;font-family: Verdana; font-size: 18px; text-align: left;&amp;quot;&amp;gt;赋值&amp;lt;/div&amp;gt;\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-36\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.2804\&quot; y=\&quot;1\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;-1\&quot; y=\&quot;22\&quot; as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-31\&quot; value=\&quot;refresh() 完成了 bean 的创建过程；以下流程是 refresh 细节\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-589.5\&quot; y=\&quot;-640\&quot; width=\&quot;873\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-38\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#000000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-35\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-37\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-40\&quot; value=\&quot;创建 BeanFactory 工厂\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Verdana;fontColor=#000000;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-38\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.3238\&quot; y=\&quot;1\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-35\&quot; value=\&quot;prepareRefresh&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;this.startupDate = System.currentTimeMillis() 启动时间赋值&amp;lt;/span&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.closed.set(false);&amp;amp;nbsp;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.active.set(true);&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;initPropertySources() 父类留给子类有关环境属性的扩展方法，父类没有实现具体逻辑&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getEnvironment().validateRequiredProperties() 校验环境属性是否全部填充完成&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;earlyApplicationListeners、applicationListeners 在 Spring Boot 中会提前加载很多事件监听器(14 个)：逻辑是判断 earlyApplicationListeners 集合是否为 null，如果为 null 将 applicationListeners 集合赋值给 earlyApplicationListeners；反之，则将 applicationListeners 集合清空，将原有 earlyApplicationListeners 赋值给 applicationListeners (Spring Boot 中就是利用了这个逻辑)&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;align=left;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-2250\&quot; y=\&quot;-380\&quot; width=\&quot;4190\&quot; height=\&quot;310\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-9\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-37\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-43\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-1\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-37\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-2\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 18px; text-align: left; background-color: rgb(248, 249, 250);&amp;quot;&amp;gt;设置 bean 工厂属性&amp;lt;/span&amp;gt;\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\&quot; parent=\&quot;t0Rb5IohVzh9Mymz01Zp-1\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.326\&quot; y=\&quot;1\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-37\&quot; value=\&quot;obtainFreshBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#e06d0d&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;refreshBeanFactory(); 针对 beanFactory的一系例操作&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getBeanFactory 获取创建成功的 BeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-485\&quot; y=\&quot;76.72\&quot; width=\&quot;660\&quot; height=\&quot;148.45\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-7\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-43\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-47\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.561;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=25;fontColor=#80FF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-43\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-61\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-43\&quot; value=\&quot;refreshBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;存在 BeanFactory 就销毁&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建 BeanFactory 工厂&amp;amp;nbsp;DefaultListableBeanFactory beanFactory = createBeanFactory()&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;customizeBeanFactory(beanFactory); 看到这个有没有觉得熟悉：类似前面提到系统环境属性的扩展点: 定义&amp;amp;nbsp; beanFactory 的属性：&amp;lt;/font&amp;gt;allowBeanDefinitionOverriding，allowCircularReferences，提供对 beanFactory的操作接口：比如添加&amp;amp;nbsp;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#80ff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;loadBeanDefinitions(beanFactory);&amp;amp;nbsp;初始化配置定义的 bean 信息，并读取解析&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;this.beanFactory = beanFactory;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#E06D0D;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-2750\&quot; y=\&quot;11.9\&quot; width=\&quot;1270\&quot; height=\&quot;278.1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-10\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-47\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-50\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-47\&quot; value=\&quot;createBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建了一个DefaultListableBeanFactory对象，又是一层层的 super&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-3430\&quot; y=\&quot;-4.060000000000002\&quot; width=\&quot;570\&quot; height=\&quot;179.4\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-53\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-50\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-52\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-50\&quot; value=\&quot;DefaultListableBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;boolean allowBeanDefinitionOverriding = true&amp;amp;nbsp;是否允许重新注册具有相同名称的不同定义&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;boolean allowEagerClassLoading = true&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;AutowireCandidateResolver autowireCandidateResolver = SimpleAutowireCandidateResolver.INSTANCE&amp;amp;nbsp;用于检查 bean 定义是否为自动装配候选者的解析器&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Map&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;, Object&amp;amp;gt; resolvableDependencies = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;(16) 从依赖类型映射到相应的自动装配值&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Map&amp;amp;lt;String, BeanDefinition&amp;amp;gt; beanDefinitionMap = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;(256)&amp;amp;nbsp;bean 定义对象的映射，以 bean 名称为键&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Map&amp;amp;lt;String, BeanDefinitionHolder&amp;amp;gt; mergedBeanDefinitionHolders = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;(256)&amp;amp;nbsp;单例和非单例 bean 名称的映射，以依赖类型为键。&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Map&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;, String[]&amp;amp;gt; singletonBeanNamesByType = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;(64) 仅单例 bean 名称的映射，以依赖类型为键&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;volatile Set&amp;amp;lt;String&amp;amp;gt; manualSingletonNames = new LinkedHashSet&amp;amp;lt;&amp;amp;gt;(16);&amp;amp;nbsp; 按照顺序手动注册单例 bean 的集合&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-5370\&quot; y=\&quot;-116.85\&quot; width=\&quot;1820\&quot; height=\&quot;405\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-55\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#00FF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-52\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-54\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-52\&quot; value=\&quot;AbstractAutowireCapableBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;InstantiationStrategy instantiationStrategy = new CglibSubclassingInstantiationStrategy() bea 实例化策略&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ParameterNameDiscoverer parameterNameDiscoverer = new DefaultParameterNameDiscoverer() 方法参数名称的解析策略&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;boolean allowCircularReferences = true; 是否尝试自动解决循环依赖&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;boolean allowRawInjectionDespiteWrapping = false 是否在循环依赖的情况下注入 bean&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Set&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;&amp;amp;gt; ignoredDependencyTypes = new HashSet&amp;amp;lt;&amp;amp;gt;() 自动装配需要忽略的类型，如字符串等，默认为 null&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00ff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final Set&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;&amp;amp;gt; ignoredDependencyInterfaces = new HashSet&amp;amp;lt;&amp;amp;gt;();&amp;amp;nbsp;在依赖检查和自动装配时忽略依赖接口，作为类对象集。默认情况下，仅忽略 BeanFactory 接口。&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final NamedThreadLocal&amp;amp;lt;String&amp;amp;gt; currentlyCreatedBean = new NamedThreadLocal&amp;amp;lt;&amp;amp;gt;(&amp;quot;Currently created bean&amp;quot;)当前创建的 bean 的名称，用于对 getBean 等调用的隐式依赖注册，这些调用由用户指定的供应商回调触发&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final ConcurrentMap&amp;amp;lt;String, BeanWrapper&amp;amp;gt; factoryBeanInstanceCache = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;()&amp;amp;nbsp;未完成 FactoryBean 实例的缓存&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final ConcurrentMap&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;, Method[]&amp;amp;gt; factoryMethodCandidateCache = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;()&amp;amp;nbsp;每个工厂类的候选工厂方法缓存&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;final ConcurrentMap&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;, PropertyDescriptor[]&amp;amp;gt; filteredPropertyDescriptorsCache 过滤后的 PropertyDescriptor 缓存：bean 类到 PropertyDescriptor 数组&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-8030\&quot; y=\&quot;-115.91\&quot; width=\&quot;2520\&quot; height=\&quot;404.06\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-54\&quot; value=\&quot;AbstractAutowireCapableBeanFactory：构造函数执行 -&amp;amp;gt; 忽略依赖接口&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;ignoreDependencyInterface(BeanNameAware.class);&amp;lt;/span&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;  &amp;lt;/span&amp;gt;ignoreDependencyInterface(BeanFactoryAware.class);&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;  &amp;lt;/span&amp;gt;ignoreDependencyInterface(BeanClassLoaderAware.class);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00FF00;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-7172.5\&quot; y=\&quot;-412.5\&quot; width=\&quot;805\&quot; height=\&quot;207.5\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-9\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=18;startArrow=none;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-75\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-81\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-10\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-61\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-63\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-61\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-65\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-16\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-61\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-75\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-61\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ea6b66&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;loadBeanDefinitions(beanFactory)：加载 XML(一系列的重载调用) 读取 bean 信息并解析&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#cc6600&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;使用适配器模式将 beanFactory 转为转&amp;amp;nbsp;&amp;lt;/font&amp;gt;XmlBeanDefinitionReader XML 解析器&amp;amp;nbsp;XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;设置 XML 解析器需要的运行环境&amp;amp;nbsp;beanDefinitionReader.setEnvironment(this.getEnvironment());&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;设置资源加载器&amp;amp;nbsp;beanDefinitionReader.setResourceLoader(this);&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;设置用于解析 SAX 实体解析器，默认使用&amp;amp;nbsp;ResourceEntityResolver 解析器。可以自定义实体解析覆盖，例如相对于某些特定的基本路径&amp;amp;nbsp;beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cccc&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;初始化解析器属性：initBeanDefinitionReader(beanDefinitionReader);&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;重载&amp;amp;nbsp;loadBeanDefinitions(beanDefinitionReader);&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-5254.04\&quot; y=\&quot;875.6199999999999\&quot; width=\&quot;2394.04\&quot; height=\&quot;290\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-18\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#CC6600;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-63\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-17\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-63\&quot; value=\&quot;创建&amp;amp;nbsp;XmlBeanDefinitionReader 对象&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final int VALIDATION_NONE = XmlValidationModeDetector.VALIDATION_NONE -&amp;amp;gt; 0;&amp;amp;nbsp; 禁用验证&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final int VALIDATION_AUTO = XmlValidationModeDetector.VALIDATION_AUTO; -&amp;amp;gt; 1 表示应自动检测验证模式。&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final int VALIDATION_DTD = XmlValidationModeDetector.VALIDATION_DTD; -&amp;amp;gt; 2 表示 DTD 格式&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final int VALIDATION_XSD = XmlValidationModeDetector.VALIDATION_XSD; -&amp;amp;gt; 3 表示 XSD 格式&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;supper()&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#E06D0D;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-7044.04\&quot; y=\&quot;498.76\&quot; width=\&quot;1410\&quot; height=\&quot;272.5\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-68\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FFFF00;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-65\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-67\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-65\&quot; value=\&quot;ResourceEntityResolver&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;super(resourceLoader.getClassLoader());&amp;amp;nbsp;&amp;amp;nbsp;调用父类方法获取对应的解析器 DTD or XSD&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;fontSize=18;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-6399.04\&quot; y=\&quot;1334.37\&quot; width=\&quot;765\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-21\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-67\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-69\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-22\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-67\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-73\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-67\&quot; value=\&quot;DelegatingEntityResolver&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;static final String DTD_SUFFIX = &amp;quot;.dtd&amp;quot;;&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;static final String XSD_SUFFIX = &amp;quot;.xsd&amp;quot;;&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;this.dtdResolver = new BeansDtdResolver();&amp;amp;nbsp; &amp;amp;nbsp;创建 DTD 解析器&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cccc&amp;quot; style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;new PluggableSchemaResolver(classLoader) XSD 解析器 -&amp;amp;gt; &amp;quot;META-INF/spring.schemas&amp;quot;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=18;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-7458.04\&quot; y=\&quot;1289.37\&quot; width=\&quot;780\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-69\&quot; value=\&quot;BeansDtdResolver&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final String DTD_EXTENSION = &amp;quot;.dtd&amp;quot;;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final String DTD_NAME = &amp;quot;spring-beans&amp;quot;;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-8464.04\&quot; y=\&quot;1302.5\&quot; width=\&quot;780\&quot; height=\&quot;153.75\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-73\&quot; value=\&quot;PluggableSchemaResolver XSD 文件路径映射&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;static final String DEFAULT_SCHEMA_MAPPINGS_LOCATION = &amp;quot;META-INF/spring.schemas&amp;quot;;定义架构映射的文件的位置。可以存在于多个 JAR 文件中&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;volatile Map&amp;amp;lt;String, String&amp;amp;gt; schemaMappings 资源路径映射&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;注意这里调试的时候&amp;amp;nbsp;schemaMappings 发现被赋值了，这其实是 IDEA 自己调用了&amp;amp;nbsp;PluggableSchemaResolver toString 方法，而 toString 方法中又包含了&amp;amp;nbsp;getSchemaMappings() 导致这个 Map 被赋值。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#82b366;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-8179.79\&quot; y=\&quot;1625.62\&quot; width=\&quot;2223.5\&quot; height=\&quot;275\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-80\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;主流程&amp;lt;/font&amp;gt;\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Verdana;fontSize=25;fontColor=#00CCCC;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-251\&quot; y=\&quot;-1290\&quot; width=\&quot;196\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-84\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-81\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-83\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=18;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-81\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-85\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-14\&quot; value=\&quot;String[] -&amp;amp;gt; String\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;\&quot; parent=\&quot;swjzN8IUrycUAb-GRa1w-13\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;0.2091\&quot; y=\&quot;1\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-81\&quot; value=\&quot;loadBeanDefinitions(XmlBeanDefinitionReader reader)：两种获取文件资源路径&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;以 Resource 方式获取&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;以 String 的形式获取&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cccc&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;重载&amp;amp;nbsp;reader.loadBeanDefinitions(configLocations)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-7564.04\&quot; y=\&quot;925.6199999999999\&quot; width=\&quot;1080\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-83\&quot; value=\&quot;String[] configLocations = getConfigLocations()：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;看到这个 getConfigLocations 应该很熟悉了吧，在设置配置文件路径的时候赋的值\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-8734.04\&quot; y=\&quot;1075.62\&quot; width=\&quot;920\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-92\&quot; value=\&quot;&amp;lt;span style=&amp;quot;color: rgb(0, 0, 0); font-size: 18px;&amp;quot;&amp;gt;&amp;amp;nbsp;String -&amp;amp;gt; Resource[]&amp;lt;/span&amp;gt;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-85\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-91\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;-5623.04\&quot; y=\&quot;875.2399999999998\&quot; as=\&quot;sourcePoint\&quot;/&gt;&lt;mxPoint x=\&quot;-5834.04\&quot; y=\&quot;875.3169230769226\&quot; as=\&quot;targetPoint\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-85\&quot; value=\&quot;loadBeanDefinitions(String... locations)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;重载&amp;amp;nbsp;loadBeanDefinitions(location)-&amp;amp;gt;&amp;amp;nbsp;loadBeanDefinitions(location, null)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#00CCCC;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-8714.04\&quot; y=\&quot;735.6199999999999\&quot; width=\&quot;900\&quot; height=\&quot;135\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-94\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-91\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-93\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-98\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#00CCCC;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-91\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-97\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-91\&quot; value=\&quot;loadBeanDefinitions(String location, @Nullable Set&amp;amp;lt;Resource&amp;amp;gt; actualResources)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;在最开始的 supper 中完成了父类&amp;amp;nbsp;ResourcePatternResolver 变量&amp;amp;nbsp;this.resourceLoader = resourceLoader(AbstractApplicationContext) 赋值&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location)&amp;amp;nbsp;获取具体资源解析器的定位 ResourcePatternResolver 有多个实现&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cccc&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;重载 loadBeanDefinitions(resources)&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-10914.04\&quot; y=\&quot;703.8699999999999\&quot; width=\&quot;1830\&quot; height=\&quot;198.5\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-93\&quot; value=\&quot;getResources(String locationPattern)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String CLASSPATH_ALL_URL_PREFIX = &amp;quot;classpath*:&amp;quot;&amp;amp;nbsp; 资源文件属性是否以 classpath* 开始&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;或者以 war: 开始&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;都不是将 location 封装成一个 Resource[] 对象&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12084.04\&quot; y=\&quot;370\&quot; width=\&quot;1110\&quot; height=\&quot;215\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-19\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;Resources[] -&amp;amp;gt; Resources&amp;lt;/font&amp;gt;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#CC6600;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-97\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-99\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-97\&quot; value=\&quot;loadBeanDefinitions(Resource... resources)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;for 循环处理 resources&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#00CCCC;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-11846.54\&quot; y=\&quot;935.6199999999999\&quot; width=\&quot;635\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-102\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-99\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-101\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-103\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-family: Helvetica; font-size: 18px; text-align: left; background-color: rgb(248, 249, 250);&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Verdana;fontColor=#000000;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-102\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;0.3588\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;15\&quot; y=\&quot;120\&quot; as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-105\&quot; value=\&quot;Resource -&amp;amp;gt; EncodeResource\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Verdana;fontColor=#000000;\&quot; parent=\&quot;-McDBByZdcgpEU9wJOO_-102\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.0664\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-99\&quot; value=\&quot;loadBeanDefinitions(Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;将 resource 封装为 encodedResource，该类实现了 InputStreamSource 并设置解析编码格式，这里什么都没有做，传的都是 null&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;继续重载调用&amp;amp;nbsp;loadBeanDefinitions(EncodedResource encodedResource)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#00CCCC;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12271.54\&quot; y=\&quot;1225.62\&quot; width=\&quot;1485\&quot; height=\&quot;198.75\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-107\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;inputSource -&amp;amp;gt; Document&amp;lt;/font&amp;gt;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-101\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-106\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-101\&quot; value=\&quot;loadBeanDefinitions(EncodedResource encodedResource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Set&amp;amp;lt;EncodedResource&amp;amp;gt; currentResources = this.resourcesCurrentlyBeingLoaded.get() 获取已经加载的 encodedResource&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;将 encodedResource 转换为输入流&amp;amp;nbsp;InputStream inputStream = encodedResource.getResource().getInputStream()，使用InputSource 封装&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;调用&amp;amp;nbsp;doLoadBeanDefinitions(inputSource, encodedResource.getResource())&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12134.04\&quot; y=\&quot;1605.62\&quot; width=\&quot;1210\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-110\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Verdana;fontSize=18;fontColor=#00CCCC;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-106\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-109\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-16\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#FF0000;strokeWidth=5;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-106\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-15\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-106\&quot; value=\&quot;doLoadBeanDefinitions(InputSource inputSource, Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cccc&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;解析配置文件内容，将其属性节点内容放入 Document 对象中&amp;amp;nbsp;Document doc = doLoadDocument(inputSource, resource)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot; color=&amp;quot;#ff0000&amp;quot;&amp;gt;创建并填充 BeanDefinition 对象&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;int count = registerBeanDefinitions(doc, resource)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12041.54\&quot; y=\&quot;2035.62\&quot; width=\&quot;1025\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-18\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-109\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-111\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-19\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-109\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-113\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-109\&quot; value=\&quot;Document doLoadDocument(InputSource inputSource, Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getEntityResolver() 获取解析器(在创建&amp;amp;nbsp;XmlBeanDefinitionReader的时候就已经赋值)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getValidationModeForResource 确定解析文档的格式&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.documentLoader.loadDocument(inputSource, getEntityResolver(), this.errorHandler,&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;getValidationModeForResource(resource), isNamespaceAware()) 使用 document 加载配置文集内容&amp;lt;/span&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#00CCCC;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12084.04\&quot; y=\&quot;2455.62\&quot; width=\&quot;1110\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-111\&quot; value=\&quot;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;loadDocument(InputSource inputSource, EntityResolver entityResolver,&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;ErrorHandler errorHandler, int validationMode, boolean namespaceAware)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;DocumentBuilderFactory factory = createDocumentBuilderFactory(validationMode, namespaceAware) 创建解析 Document 工厂&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;构建解析器&amp;amp;nbsp;&amp;lt;/span&amp;gt;DocumentBuilder builder = createDocumentBuilder(factory, entityResolver, errorHandler)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;使用解析器解析 Document 获取配置文档的内容节点&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-10894.04\&quot; y=\&quot;2480.62\&quot; width=\&quot;1720\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-20\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-113\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-115\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-113\&quot; value=\&quot;getValidationModeForResource(Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;int validationModeToUse = getValidationMode() 获取验证模式，在初始化 XmlBeanDefinitionReader 时已经赋值 1 自动识别&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;确定解析文档格式&amp;amp;nbsp;int detectedMode = detectValidationMode(resource)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12241.54\&quot; y=\&quot;2840\&quot; width=\&quot;1425\&quot; height=\&quot;220\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-115\&quot; value=\&quot;this.validationModeDetector.detectValidationMode(inputStream) 委派模式&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;遍历读取文档内容，返回每行读内容 content = consumeCommentTokens(content)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断 content 是否包含 DTD 声明的内容&amp;amp;nbsp;hasDoctype(content) 如果是&amp;amp;nbsp;isDtdValidated = true 文档格式为 DTD&amp;amp;nbsp;&amp;amp;nbsp;return (isDtdValidated ? VALIDATION_DTD : VALIDATION_XSD)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;hasOpeningTag(content) 如果是 XML 则 isDtdValidated = true 则 文档格式为 XML&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-12579.04\&quot; y=\&quot;3195\&quot; width=\&quot;2100\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-15\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-20\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-27\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-15\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-3\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-15\&quot; value=\&quot;registerBeanDefinitions(Document doc, Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建&amp;amp;nbsp;BeanDefinitionDocumentReader 对象&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;记录未填充前 beanDefinitionMap 集合的大小&amp;amp;nbsp;&amp;amp;nbsp;int countBefore = getRegistry().getBeanDefinitionCount()&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#66ffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;createReaderContext(resource) 创建了一个&amp;amp;nbsp;XmlReaderContext，并获取逻辑命名空间处理器映射&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;调用&amp;amp;nbsp;documentReader.registerBeanDefinitions(doc, createReaderContext(resource)) 创建并填充 BeanDefinition 对象;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-18464.04\&quot; y=\&quot;2215.62\&quot; width=\&quot;1395\&quot; height=\&quot;228.75\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-17\&quot; value=\&quot;AbstractBeanDefinitionReader&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.registry = registry =&amp;amp;nbsp;DefaultListableBeanFactory&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#E06D0D;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-7874.04\&quot; y=\&quot;581.26\&quot; width=\&quot;730\&quot; height=\&quot;107.5\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-24\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-20\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-24\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-28\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-20\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-31\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-20\&quot; value=\&quot;doRegisterBeanDefinitions(Element root)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;doRegisterBeanDefinitions(doc.getDocumentElement());&amp;amp;nbsp; doc.getDocumentElement() 获取配置文档的标签属性&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建一个解析器，对应配置文档中的标签属性&amp;amp;nbsp;this.delegate = createDelegate(getReaderContext(), root, parent)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断是否是默认的命名空间，接着判断是否包含 profile 属性，对 profile 的一些逻辑处理；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;preProcessXml(root) 父类 DefaultBeanDefinitionDocumentReader 中没有实现该方法，留给子类扩展，在 bean 定义前，可以添加 自定义元素，来扩展 XML 标签属性；&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff00ff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;parseBeanDefinitions(root, this.delegate) 解析配置文件中的标签元素&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;postProcessXml(root)&amp;amp;nbsp; 父类 DefaultBeanDefinitionDocumentReader 中没有实现该方法，留给子类扩展，在 bean 完成 bean 定义后，可以添加自定义元素，来扩展 XML 标签属性；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17684.04\&quot; y=\&quot;2670\&quot; width=\&quot;2069\&quot; height=\&quot;290\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-23\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-24\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-28\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-24\&quot; value=\&quot;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;BeanDefinitionParserDelegate createDelegate(&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;XmlReaderContext readerContext, Element root, @Nullable BeanDefinitionParserDelegate parentDelegate)：&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;BeanDefinitionParserDelegate delegate = new BeanDefinitionParserDelegate(readerContext) 这个类中定义了许多标签属性&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;initDefaults(Element root, @Nullable BeanDefinitionParserDelegate parent) 初始化默认的lazy-init、autowire、依赖检查设置、init-method、destroy-method和merge设置。如果默认值未在本地显式设置，则通过回退到给定的父级来支持嵌套的“bean”元素用例。&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-15269.910000000003\&quot; y=\&quot;2710\&quot; width=\&quot;2940\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-28\&quot; value=\&quot;initDefaults(Element root, @Nullable BeanDefinitionParserDelegate parent)：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;populateDefaults(this.defaults, (parent != null ? parent.defaults : null), root) 使用默认的惰性初始化、自动装配、依赖性检查设置、初始化方法、销毁方法和合并设置填充给定的 DocumentDefaultsDefinition 实例&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;fireDefaultsRegistered(DefaultsDefinition defaultsDefinition)&amp;amp;nbsp;触发默认注册事件&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-15054.04\&quot; y=\&quot;2345.62\&quot; width=\&quot;2508.27\&quot; height=\&quot;155\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-29\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-31\&quot; target=\&quot;vvphals0SzpIUJqCIcSN-4\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-31\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-31\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-33\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-31\&quot; value=\&quot;parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断标签是否是默认的命名空间，且元素是否是 Element 类，全都符合再次判断是不是标准定义的标签，是的话就按照标准定义进行解析&amp;amp;nbsp;parseDefaultElement(ele, delegate)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;不是则按照自定义标签进行解析&amp;amp;nbsp;delegate.parseCustomElement(ele)&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF00FF;strokeColor=#FF00FF;rounded=0;fontColor=#000000;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17641.79\&quot; y=\&quot;3095.62\&quot; width=\&quot;1984.5\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-32\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-33\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-44\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-33\&quot; value=\&quot;parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断是否是 import 标签：importBeanDefinitionResource(ele)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断是否是alias 标签：processAliasRegistration(ele)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#0000ff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断是否是 bean 标签：processBeanDefinition(ele, delegate)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断是否是&amp;amp;nbsp;beans 标签：doRegisterBeanDefinitions(ele)&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFFFF;strokeColor=#000000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-14296.54\&quot; y=\&quot;3335.62\&quot; width=\&quot;855\&quot; height=\&quot;240\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-40\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-36\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-40\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-36\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;parseBeanDefinitionElement(Element ele)：&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 255); font-size: 25px;&amp;quot;&amp;gt;获取 bean 的 id 属性；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 255); font-size: 25px;&amp;quot;&amp;gt;获取 bean 的 name 属性&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 255); font-size: 25px;&amp;quot;&amp;gt;校验 bean 的 name 是否唯一&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;parseBeanDefinitionElement(ele, beanName, containingBean) 对 bean 元素进行详细解析：比如 bean 类是一个接口、抽象类等等&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF3333;strokeColor=#000000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-15208.04\&quot; y=\&quot;4195.62\&quot; width=\&quot;1500\&quot; height=\&quot;271.25\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-40\&quot; value=\&quot;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;parseBeanDefinitionElement(&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;Element ele, String beanName, @Nullable BeanDefinition containingBean)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;获取 class 属性&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;className = ele.getAttribute(CLASS_ATTRIBUTE).trim()&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;获取 parent 属性&amp;amp;nbsp;parent = ele.getAttribute(PARENT_ATTRIBUTE)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;AbstractBeanDefinition bd = createBeanDefinition(className, parent);&amp;amp;nbsp;&amp;amp;nbsp;为给定的类名和父名创建一个 bean 定义 实际操作类是 GenericBeanDefinition，其实此时已经满足实例化 BeanDefinition 了。创建了GenericBeanDefinition 对象&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;接着是对标签元素的一系列解析，以及对 GenericBeanDefinition&amp;amp;nbsp;实现了 BeanDefinition 接口 的属性填充：比如构造函数解析、子类方法解析等&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;得到完整的 beanDeinitions 后，返回一个&amp;amp;nbsp;new BeanDefinitionHolder(beanDefinition, beanName, aliasesArray)，该类是对 BeanDefinition 的封装。&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-15311.79\&quot; y=\&quot;4555.62\&quot; width=\&quot;1707.5\&quot; height=\&quot;320\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-37\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-44\&quot; target=\&quot;swjzN8IUrycUAb-GRa1w-36\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-38\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;swjzN8IUrycUAb-GRa1w-44\&quot; target=\&quot;vvphals0SzpIUJqCIcSN-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;swjzN8IUrycUAb-GRa1w-44\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate)：&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;解析标签元素得到&amp;amp;nbsp;BeanDefinitionHolder -&amp;amp;gt;delegate.parseBeanDefinitionElement(ele)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#80ff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;向 IOC 容器注册解析得到 beanDefinition 的地方&amp;amp;nbsp;BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry())&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#3333FF;strokeColor=#000000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-14624.04\&quot; y=\&quot;3745.62\&quot; width=\&quot;1510\&quot; height=\&quot;225.62\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-39\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vvphals0SzpIUJqCIcSN-0\&quot; target=\&quot;vvphals0SzpIUJqCIcSN-2\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vvphals0SzpIUJqCIcSN-0\&quot; value=\&quot;registerBeanDefinition(String beanName, BeanDefinition beanDefinition)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;获取 bean 名称&amp;amp;nbsp;BeanDefinition existingDefinition = this.beanDefinitionMap.get(beanName)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition()) 注册bean&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;遍历注册 beanDefinition 的别名，其大致流程与注册 beanDefinition 相似，最后将别名放入&amp;amp;nbsp;this.aliasMap.put(alias, name) 集合中&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#80FF00;strokeColor=#000000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-13124.04\&quot; y=\&quot;4195.62\&quot; width=\&quot;1472.5\&quot; height=\&quot;205.63\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vvphals0SzpIUJqCIcSN-2\&quot; value=\&quot;&amp;lt;div style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;registerBeanDefinition(String beanName, BeanDefinition beanDefinition)：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;判断该 bean 是否已经创建，如果已经创建，判断是否允许被覆盖&amp;amp;nbsp;isAllowBeanDefinitionOverriding() ，不允许抛出异常，允许的话继续执行，后续是一系列的判断然后输出日志，最后将 beanDefinition 放入&amp;amp;nbsp;beanDefinitionMap；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;如果没有创建，判断这个工厂的 bean 创建阶段是否已经开始，如果开始则需要将此时的 beanDefinition 放入，移除旧的名称集&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;如果这个工程的 bean 的创建工程没有开始，则将 beanName -&amp;amp;gt; beanDefinition 放入 beanDefinitionMap，名称 beanName放入&amp;amp;nbsp;beanDefinitionNames 集合中，此时就已经将 beanDefinition 注册成功了&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF3333;strokeColor=#000000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-13567.79\&quot; y=\&quot;4555.62\&quot; width=\&quot;2360\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-30\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=27;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;vvphals0SzpIUJqCIcSN-4\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;vvphals0SzpIUJqCIcSN-4\&quot; value=\&quot;BeanDefinition parseCustomElement(Element ele)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;parseCustomElement(ele, null)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17027.04\&quot; y=\&quot;3426.87\&quot; width=\&quot;755\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-41\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;TSj2-_jnBFrJ9VK-oBdi-0\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-0\&quot; value=\&quot;parseCustomElement(Element ele, @Nullable BeanDefinition containingBd)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;获取标签对应的命名空间 比如：context对应 url： http://www.springframework.org/schema/context&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;获取解析命名空间的处理器&amp;amp;nbsp;NamespaceHandler ：NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17564.54\&quot; y=\&quot;3685.62\&quot; width=\&quot;1830\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-33\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;TSj2-_jnBFrJ9VK-oBdi-3\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-5\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-3\&quot; value=\&quot;XmlReaderContext createReaderContext(Resource resource)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#9933ff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;getNamespaceHandlerResolver 如果没有指定，则获取默认的命名空间处理器&amp;amp;nbsp;DefaultNamespaceHandlerResolver，读取默认的 handler 路径：&amp;amp;nbsp;META-INF/spring.handlers&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建一个&amp;amp;nbsp;XmlReaderContext 对象&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#66FFFF;strokeColor=#66FFFF;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-20204.04\&quot; y=\&quot;2670\&quot; width=\&quot;1960\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-34\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;TSj2-_jnBFrJ9VK-oBdi-5\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-7\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-5\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;NamespaceHandlerResolver getNamespaceHandlerResolver()：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;如果命名处理器为 null 则创建一个默认的&amp;amp;nbsp;this.namespaceHandlerResolver = createDefaultNamespaceHandlerResolver()&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#9933FF;strokeColor=#9933FF;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-19924.04\&quot; y=\&quot;2955.62\&quot; width=\&quot;1400\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-35\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;TSj2-_jnBFrJ9VK-oBdi-7\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-9\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-7\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffffff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;NamespaceHandlerResolver createDefaultNamespaceHandlerResolver()&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 255); font-size: 25px;&amp;quot;&amp;gt;如果资源处理器不为 null，则取资源类加载器&amp;amp;nbsp; getResourceLoader().getClassLoader()，否则获取 beanClassLoader bean 加载器；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#66ff66&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建&amp;amp;nbsp;new DefaultNamespaceHandlerResolver(cl) 对象&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#9933FF;strokeColor=#9933FF;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-19979.04\&quot; y=\&quot;3225.62\&quot; width=\&quot;1510\&quot; height=\&quot;151.25\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-36\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;TSj2-_jnBFrJ9VK-oBdi-9\&quot; target=\&quot;TSj2-_jnBFrJ9VK-oBdi-11\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-9\&quot; value=\&quot;DefaultNamespaceHandlerResolver(@Nullable ClassLoader classLoader)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this(classLoader, DEFAULT_HANDLER_MAPPINGS_LOCATION) 使用默认的映射文件&amp;amp;nbsp;spring.handlers 创建新的命名空间处理器&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#66FF66;strokeColor=#66FF66;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-19761.54\&quot; y=\&quot;3515.62\&quot; width=\&quot;1075\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;TSj2-_jnBFrJ9VK-oBdi-11\&quot; value=\&quot;DefaultNamespaceHandlerResolver(@Nullable ClassLoader classLoader, String handlerMappingsLocation)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.handlerMappingsLocation = handlerMappingsLocation 命名空间处理器映射文件位置&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.classLoader = (classLoader != null ? classLoader : ClassUtils.getDefaultClassLoader())&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#66FF66;strokeColor=#66FF66;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-19759.04\&quot; y=\&quot;3775.62\&quot; width=\&quot;1070\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-42\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-0\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-5\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-43\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-0\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-3\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-0\&quot; value=\&quot;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.readerContext.getNamespaceHandlerResolver()：这个获取命名空间处理器应该很熟悉，在前面&amp;amp;nbsp;XmlReaderContext 的时候 this.namespaceHandlerResolver 就被赋值了；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri) 获取NamespaceHandler 处理器的映射&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00ff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;通过命名空间处理器解析配置文件 handler.parse(ele, new ParserContext(this.readerContext, this, containingBd))&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#FF0000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17639.54\&quot; y=\&quot;3955.62\&quot; width=\&quot;1980\&quot; height=\&quot;155.62\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-3\&quot; value=\&quot;NamespaceHandler resolve(String namespaceUri)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;Map&amp;amp;lt;String, Object&amp;amp;gt; handlerMappings = getHandlerMappings()&amp;amp;nbsp;延迟加载指定的 NamespaceHandler 映射&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 25px;&amp;quot;&amp;gt;实例化命名空间处理器 NamespaceHandler namespaceHandler = (NamespaceHandler) BeanUtils.instantiateClass(handlerClass);&amp;lt;/span&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;初始化自定义元素 namespaceHandler.init();&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;将得到的映射文件 Uri 与 命名空间处理器放入 handlerMappings 集合handlerMappings.put(namespaceUri, namespaceHandler);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-19284.04\&quot; y=\&quot;4265.62\&quot; width=\&quot;1510\&quot; height=\&quot;230\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-44\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-5\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-7\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-45\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-5\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-11\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-5\&quot; value=\&quot;BeanDefinition parse(Element element, ParserContext parserContext)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;在 ParserContext&amp;amp;nbsp; bean 定义解析过程中传递的上下文，封装所有相关配置和状态&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;根据元素名称属性获取 beanDefinition 解析器：&amp;amp;nbsp;BeanDefinitionParser parser = findParserForElement(element, parserContext)&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff00ff&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;解析器解析&amp;amp;nbsp;parser.parse(element, parserContext)&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#00FF00;strokeColor=#00FF00;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-17354.29\&quot; y=\&quot;4235.62\&quot; width=\&quot;1409.5\&quot; height=\&quot;220.62\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-46\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-7\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-9\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-7\&quot; value=\&quot;BeanDefinition parse(Element element, ParserContext parserContext)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;根据元素名称属性获取 beanDefinition 解析器&amp;amp;nbsp;BeanDefinitionParser parser = findParserForElement(element, parserContext)&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#FF0000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-18384.04\&quot; y=\&quot;4645.62\&quot; width=\&quot;1485\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-9\&quot; value=\&quot;BeanDefinitionParser findParserForElement(Element element, ParserContext parserContext)：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;String localName = parserContext.getDelegate().getLocalName(element)&amp;amp;nbsp; 获取元素名称&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;BeanDefinitionParser parser = this.parsers.get(localName)&amp;amp;nbsp;根据元素名称找到对应的解析器&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#FF0000;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-18177.79\&quot; y=\&quot;4890\&quot; width=\&quot;1072.5\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-47\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=25;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;5atNqO5YCdcayf-Q1qNk-11\&quot; target=\&quot;5atNqO5YCdcayf-Q1qNk-15\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-11\&quot; value=\&quot;BeanDefinition parse(Element element, ParserContext parserContext)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot; style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建一个解析的对象，方便后续对元素属性的操作&amp;amp;nbsp;AbstractBeanDefinition definition = parseInternal(element, parserContext)&amp;lt;/font&amp;gt;&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建一个&amp;amp;nbsp;BeanDefinitionHolder&amp;amp;nbsp;BeanDefinitionHolder holder = new BeanDefinitionHolder(definition, id, aliases)&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;调用&amp;amp;nbsp;registerBeanDefinition(holder, parserContext.getRegistry()) 注册 BeanDefinition&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;是否要触发通知事件&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF00FF;strokeColor=#FF00FF;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-16734.04\&quot; y=\&quot;4645.62\&quot; width=\&quot;1370\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;5atNqO5YCdcayf-Q1qNk-15\&quot; value=\&quot;AbstractBeanDefinition parseInternal(Element element, ParserContext parserContext)&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;创建 BeanDefinition 生成器&amp;amp;nbsp;BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition()&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;对 builder 的子类 (AbstractBeanDefinition) 设置，如果需要设置的话，比如：bena 父类名称， bean 的具体类， bean 类名等；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;doParse(element, parserContext, builder) 填充 beanDefinition 属性：&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;fontColor=#000000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-16776.54\&quot; y=\&quot;5025.62\&quot; width=\&quot;1455\&quot; height=\&quot;300\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;-McDBByZdcgpEU9wJOO_-75\&quot; value=\&quot;设置解析方式:&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;ol style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.validationMode = 1 表示应自动检测验证模式&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;this.namespaceAware&amp;lt;b style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/b&amp;gt;= false&amp;lt;br style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;fillColor=#00CCCC;strokeColor=#00CCCC;rounded=0;fontSize=25;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-6334.04\&quot; y=\&quot;935.6199999999999\&quot; width=\&quot;700\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;8aI2bJ5IGFcjeBgnvbSx-51\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=25;strokeWidth=5;exitX=0;exitY=0.5;exitDx=0;exitDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;-McDBByZdcgpEU9wJOO_-8\&quot; target=\&quot;-McDBByZdcgpEU9wJOO_-15\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-23\&quot; value=\&quot;\&quot; style=\&quot;endArrow=classic;html=1;rounded=0;fontSize=25;fontColor=#000000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;-17640\&quot; y=\&quot;3360\&quot; as=\&quot;sourcePoint\&quot;/&gt;&lt;mxPoint x=\&quot;-15650\&quot; y=\&quot;3360\&quot; as=\&quot;targetPoint\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-24\&quot; value=\&quot;以下部分是自定义 XML 标签元素的解析过程\&quot; style=\&quot;edgeLabel;resizable=0;html=1;align=center;verticalAlign=middle;fontSize=37;fontColor=#000000;strokeWidth=8;\&quot; parent=\&quot;ZeKIb3R78Dg6MLLJOp1T-23\&quot; connectable=\&quot;0\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;ZeKIb3R78Dg6MLLJOp1T-25\&quot; value=\&quot;注意说明：图中每个模块字体颜色的处理逻辑对应与字体颜色相同的模块，模块与模块之间颜色相同表明是程序执行的流程&amp;lt;br style=&amp;quot;font-size: 74px;&amp;quot;&amp;gt;模块下面没有分支表明程序结束。模块方法执行返回值参考源码看\&quot; style=\&quot;text;html=1;strokeColor=#B20000;fillColor=#e51400;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=74;fontColor=#ffffff;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-3350\&quot; y=\&quot;-2050\&quot; width=\&quot;4260\&quot; height=\&quot;448\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-12\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FF0000;strokeWidth=5;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-11\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-14\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#F19C99;strokeWidth=5;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-13\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-22\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-21\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-30\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#0000FF;strokeWidth=5;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-29\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-41\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#000000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-40\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-0\&quot; value=\&quot;prepareBeanFactory(beanFactory)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;getClassLoader() 熟不熟悉，就是最开始 supper(parent) 时设置的，在这里进行获取&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;beanFactory.setBeanClassLoader(getClassLoader()) 设置资源加载器，&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#f19c99&amp;quot;&amp;gt;beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader())); 设置 beanFactory 表达式的语言处理器&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff00ff&amp;quot;&amp;gt;beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment()))&amp;amp;nbsp;为 beanFactory 增加一个默认的 PropertyEditorRegistrar, 这个主要是针对 bean 属性等设置管理的一个工具类，可以自定义扩展类实现 beanFactory 的解析: 比如解析 地址：xxx_xxx_xx 定义相应的规则实现解析&amp;amp;nbsp;这个解析方法是 registerCustomEditors, 可以重写实现我自己的解析方法&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#0000ff&amp;quot;&amp;gt;beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this)) 添加 bean 实例化后的后置处理器(我们可以自己创建一个 Aware 类实现 BeanPostProcessor 接口，可以实现对(这样的需求很少))某些 Aware 的注入&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;忽略一些接口的注入，这是因为这些接口在实现 BenaPostProcessor 的 Aware 接口中已经设置过了, 不需要重复注入&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;设置几个自动装配的特殊规则，当在进行 ioc 初始化的如果有多个实现，那么就使用指定的对象进行注入比如注入对象的时候，根据类型注入。比如 BeanFactory 接口就有多个实现，我们通过beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory); 可以指定具体的实现对象&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;添加 bean 实例化后的后置处理器&amp;amp;nbsp;beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this))&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;amp;nbsp;添加对 aspectJ 的支持。aspectJ 提供了两种织入(AOP)方式，第一种是通过特殊编译器，将 aspectJ 语言编写的切面类织入到 Java 中，第二种就是类加载器织入，就是下面这段代码 ：如果 beanFactory 中包含了&amp;amp;nbsp;loadTimeWeaver，则添加new LoadTimeWeaverAwareProcessor(beanFactory)&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;将 默认的系统环境添加到一级缓存中 environment、systemProperties、systemEnvironment&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-1112.65\&quot; y=\&quot;370\&quot; width=\&quot;1915.31\&quot; height=\&quot;550\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-8\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-3\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-7\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-3\&quot; value=\&quot;AbstractApplicationContext()&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;this.resourcePatternResolver = getResourcePatternResolver()&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#CC00CC;strokeColor=#CC00CC;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;5160\&quot; y=\&quot;-922.5\&quot; width=\&quot;750\&quot; height=\&quot;155\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-5\&quot; value=\&quot;DefaultResourceLoader&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;ClassLoader classLoader&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;private final Set&amp;amp;lt;ProtocolResolver&amp;amp;gt; protocolResolvers = new LinkedHashSet&amp;amp;lt;&amp;amp;gt;(4)&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;private final Map&amp;amp;lt;Class&amp;amp;lt;?&amp;amp;gt;, Map&amp;amp;lt;Resource, ?&amp;amp;gt;&amp;amp;gt; resourceCaches = new ConcurrentHashMap&amp;amp;lt;&amp;amp;gt;(4)&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;在构造函数中 this.classLoader = ClassUtils.getDefaultClassLoader()&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;5160\&quot; y=\&quot;-1360\&quot; width=\&quot;1190\&quot; height=\&quot;220\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-10\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-7\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-9\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-7\&quot; value=\&quot;AbstractApplicationContext -&amp;amp;gt; ResourcePatternResolver getResourcePatternResolver()&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;return new PathMatchingResourcePatternResolver(this)&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;6050\&quot; y=\&quot;-912.5\&quot; width=\&quot;980\&quot; height=\&quot;135\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-9\&quot; value=\&quot;PathMatchingResourcePatternResolver&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.resourceLoader = resourceLoader;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#FF0000;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;7100\&quot; y=\&quot;-932.5\&quot; width=\&quot;600\&quot; height=\&quot;175\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-11\&quot; value=\&quot;ClassLoader getClassLoader()&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;return (this.classLoader != null ? this.classLoader : ClassUtils.getDefaultClassLoader())&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1070\&quot; y=\&quot;23.800000000000026\&quot; width=\&quot;1040\&quot; height=\&quot;127.81\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-16\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FF0000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-13\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-15\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-39\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=25;fontColor=#00FFFF;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-13\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-37\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-13\&quot; value=\&quot;StandardBeanExpressionResolver(@Nullable ClassLoader beanClassLoader)：&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;来看下这类的属性&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;public static final String DEFAULT_EXPRESSION_PREFIX = &amp;quot;#{&amp;quot;;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;public static final String DEFAULT_EXPRESSION_SUFFIX = &amp;quot;}&amp;quot;;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff00ff&amp;quot;&amp;gt;this.expressionParser = new SpelExpressionParser(new SpelParserConfiguration(null, beanClassLoader))&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#F19C99;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1070\&quot; y=\&quot;201.9\&quot; width=\&quot;1390\&quot; height=\&quot;224.66\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-18\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-15\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-17\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-24\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FF00FF;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-15\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-19\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-15\&quot; value=\&quot;SpelParserConfiguration(@Nullable SpelCompilerMode compilerMode, @Nullable ClassLoader compilerClassLoader)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;this(compilerMode, compilerClassLoader, false, false, Integer.MAX_VALUE)调用自己的构造函数赋值&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2581\&quot; y=\&quot;250.17000000000002\&quot; width=\&quot;1339\&quot; height=\&quot;128.12\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-17\&quot; value=\&quot;&amp;lt;div&amp;gt;SpelParserConfiguration(@Nullable SpelCompilerMode compilerMode, @Nullable ClassLoader compilerClassLoader,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;&amp;quot;&amp;gt;   &amp;lt;/span&amp;gt;boolean autoGrowNullReferences, boolean autoGrowCollections, int maximumAutoGrowSize)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.compilerMode = (compilerMode != null ? compilerMode : defaultCompilerMode); 编译器模式 OFF 关闭，在 static 中处理赋值&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.compilerClassLoader = compilerClassLoader;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.autoGrowNullReferences = autoGrowNullReferences&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.autoGrowCollections = autoGrowCollections&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.maximumAutoGrowSize = maximumAutoGrowSize&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;4020\&quot; y=\&quot;171.73000000000002\&quot; width=\&quot;1480\&quot; height=\&quot;285\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-19\&quot; value=\&quot;SpelExpressionParser(SpelParserConfiguration configuration)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.configuration = configuration&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF00FF;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2871.75\&quot; y=\&quot;11.899999999999999\&quot; width=\&quot;757.5\&quot; height=\&quot;125.62\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-26\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FF00FF;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-21\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-25\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-21\&quot; value=\&quot;ResourceEditorRegistrar(ResourceLoader resourceLoader, PropertyResolver propertyResolver) 创建编辑器的时候付初始值&amp;amp;nbsp;&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.resourceLoader = resourceLoader;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.propertyResolver = propertyResolver&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;div&amp;gt;在&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;在 ResourceEditorRegistrar 类中实现了接口类 PropertyEditorRegistrar 的registerCustomEditors(PropertyEditorRegistry registry) 方法完成&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;bean 的解析。所以我们可以创建一个自己的资源编辑器并实现这个接口来完成自定义bean的解析，&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF00FF;strokeColor=#FF00FF;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1070\&quot; y=\&quot;715.77\&quot; width=\&quot;1700\&quot; height=\&quot;246.88\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-25\&quot; value=\&quot;addPropertyEditorRegistrar(PropertyEditorRegistrar registrar)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.propertyEditorRegistrars.add(registrar); 将编辑器添加到&amp;amp;nbsp;自定义 PropertyEditor 注册器以应用于此工厂的 bean 的集合中&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2880\&quot; y=\&quot;754.4499999999999\&quot; width=\&quot;1040\&quot; height=\&quot;169.53\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-32\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#000000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-29\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-31\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-29\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;ApplicationContextAwareProcessor(ConfigurableApplicationContext applicationContext)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;this.applicationContext = applicationContext;&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;this.embeddedValueResolver = new EmbeddedValueResolver(applicationContext.getBeanFactory());&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#0000FF;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1070\&quot; y=\&quot;1117.52\&quot; width=\&quot;1210\&quot; height=\&quot;198.74\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-34\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-31\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-33\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-36\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#00FFFF;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-31\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-35\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-31\&quot; value=\&quot;EmbeddedValueResolver(ConfigurableBeanFactory beanFactory)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;this.exprContext = new BeanExpressionContext(beanFactory, null);&amp;amp;nbsp;用于评估 bean 定义中的表达式的上下文对象。&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#00ffff&amp;quot;&amp;gt;this.exprResolver = beanFactory.getBeanExpressionResolver();&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2370\&quot; y=\&quot;1117.52\&quot; width=\&quot;1040\&quot; height=\&quot;195.55\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-33\&quot; value=\&quot;BeanExpressionContext(ConfigurableBeanFactory beanFactory, @Nullable Scope scope)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.beanFactory = beanFactory;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;this.scope = scope&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3540\&quot; y=\&quot;1028.7800000000002\&quot; width=\&quot;1060\&quot; height=\&quot;148.74\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-35\&quot; value=\&quot;BeanExpressionResolver getBeanExpressionResolver()&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;return this.beanExpressionResolver&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#00FFFF;strokeColor=#00FFFF;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3540\&quot; y=\&quot;1221.9\&quot; width=\&quot;870\&quot; height=\&quot;124.37\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-37\&quot; value=\&quot;public void setBeanExpressionResolver(@Nullable BeanExpressionResolver resolver)&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;this.beanExpressionResolver = resolver;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#F19C99;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1250\&quot; y=\&quot;501.9\&quot; width=\&quot;1030\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-43\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#000000;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-40\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-42\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-40\&quot; value=\&quot;postProcessBeanFactory(beanFactory)：&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;子类覆盖方法做额外的处理，此处一般不做任何扩展工作，在 Spring MVC 中有相关的操作&amp;lt;/span&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-686.26\&quot; y=\&quot;1070\&quot; width=\&quot;1062.51\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-45\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#000000;strokeWidth=5;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-42\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-44\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fontSize=25;fontColor=#FFFF33;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-42\&quot; target=\&quot;HpXuxDKBIxLuHr3aR9rR-5\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-42\&quot; value=\&quot;invokeBeanFactoryPostProcessors(beanFactory)：调用各种 beanFactory 处理器&amp;lt;br&amp;gt;&amp;lt;ol style=&amp;quot;color: rgb(0, 0, 255);&amp;quot;&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#0000ff&amp;quot;&amp;gt;PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors())&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-854.68\&quot; y=\&quot;1402.82\&quot; width=\&quot;1399.37\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-47\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=25;fontColor=#FFFF00;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-44\&quot; target=\&quot;t0Rb5IohVzh9Mymz01Zp-46\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-44\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;getBeanFactoryPostProcessors():&amp;amp;nbsp; 获取已经注册的&amp;amp;nbsp;beanFactoryPostProcessor，我们可以通过重写前面提到过的 customizeBeanFactory()&amp;amp;nbsp; 方法将我们自己实现&amp;lt;/font&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;BeanFactoryPostProcessors的类添加到&amp;lt;/span&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;beanFactoryPostProcessors集合中&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#0000FF;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1751.75\&quot; y=\&quot;1417.82\&quot; width=\&quot;1120\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-3\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#3333FF;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;t0Rb5IohVzh9Mymz01Zp-46\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-2\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;t0Rb5IohVzh9Mymz01Zp-46\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#0000ff&amp;quot;&amp;gt;invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors())&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;if (beanFactory instanceof BeanDefinitionRegistry) 将&amp;lt;font color=&amp;quot;#0000ff&amp;quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/font&amp;gt;beanFactoryPostProcessors 分类：List&amp;amp;lt;BeanFactoryPostProcessor&amp;amp;gt; regularPostProcessors = new ArrayList&amp;amp;lt;&amp;amp;gt;();&amp;amp;nbsp;List&amp;amp;lt;BeanDefinitionRegistryPostProcessor&amp;amp;gt; registryProcessors = new ArrayList&amp;amp;lt;&amp;amp;gt;(); 并执行对应的处理器方法&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;根据类型&amp;amp;nbsp;BeanDefinitionRegistryPostProcessor 获取接口类，用户通过重写 customizeBeanFactory 手动添加&amp;amp;nbsp;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;String[] postProcessorNames =&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;span style=&amp;quot;&amp;quot;&amp;gt;     &amp;lt;/span&amp;gt;beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false); 并执行对应的处理方法&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;再次根据类型&amp;amp;nbsp;postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false); 这是因为 4 中执行对应的处理器方法可能会再次注册实现 BeanDefinitionRegistryPostProcessor 的接口类；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;循环获取实现BeanDefinitionRegistryPostProcessor 接口类；&amp;amp;nbsp; while (reiterate){.&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);},执行对应处理器的方法；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#3333ff&amp;quot;&amp;gt;执行上述代码中放入 registryProcessors、regularPostProcessors 集合中的接口类的 postProcessBeanFactory；invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;如果 beanFactoryPostProcessors 集合没有实现 BeanDefinitionRegistryPostProcessor 接口；那么调用&amp;amp;nbsp;invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);完成 postProcessBeanFactory 方法调用&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;接着还需要处理 Spring 根据类型获取实现 beanFactoryPostProcessor 接口的类，突然根据接口类判断是否实现了 PriorityOrdered 或者 Ordered 接口，或者都没有实现，分成三个逻辑处理：&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;List&amp;amp;lt;BeanFactoryPostProcessor&amp;amp;gt; priorityOrderedPostProcessors = new ArrayList&amp;amp;lt;&amp;amp;gt;();invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;amp;nbsp;List&amp;amp;lt;String&amp;amp;gt; orderedPostProcessorNames = new ArrayList&amp;amp;lt;&amp;amp;gt;(); invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;List&amp;amp;lt;String&amp;amp;gt; nonOrderedPostProcessorNames = new ArrayList&amp;amp;lt;&amp;amp;gt;()；&amp;amp;nbsp;invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF00;strokeColor=#FFFF00;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1546.75\&quot; y=\&quot;1840\&quot; width=\&quot;1530\&quot; height=\&quot;770\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FF0000;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-2\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-4\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-25\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#00CC00;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-2\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-24\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-2\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;在执行后置处理器的时候，这里有一个Spring 内置的处理器实现类&amp;amp;nbsp;ConfigurationClassPostProcessor，该类实现了&amp;amp;nbsp;BeanDefinitionRegistryPostProcessor 接口，而&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;BeanDefinitionRegistryPostProcessor 继承了&amp;lt;/span&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;BeanFactoryPostProcessor 接口，因此执行后置处理器的时候会执行&amp;lt;/font&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;ConfigurationClassPostProcessor.&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;processConfigBeanDefinitions 完成对配置类注解的解析&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;String[] candidateNames = registry.getBeanDefinitionNames()：获取所有要处理的 BeanDefinition 名称；&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff00&amp;quot;&amp;gt;循环遍历处理对应 BeanDefinition 对象：&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;ol style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;li style=&amp;quot;color: rgb(255, 255, 0);&amp;quot;&amp;gt;判断 BeanDefinition 对象是否已经被处理过：根据 BeanDefinition 对象的 attribute 的属性，如果没有处理过的 BeanDefinition 对象，attribute 属性一定为 null；不为空判断日志级别，处于 debug，则输出提示日志表明该对象已经处理过；&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;接着判断给对象是否是一个注解类，如果是则添加到注解类集合中：configCandidates；&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;判断当前类是否该添加了其他注解；&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;如果 BeanDefinition 进行排序，(包含了 @Order 注解)；&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;获取生成 BeanDefinition 名称的自定义生成器，如果有，则执行对应的名称生成逻辑；没有按照默认生成器执行&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#00cc00&amp;quot;&amp;gt;创建&amp;amp;nbsp;ConfigurationClassParser 对象，遍历 configCandidates 注解类 调用 org.springframework.context.annotation.ConfigurationClassParser#parse(java.util.Set&amp;amp;lt;org.springframework.beans.factory.config.BeanDefinitionHolder&amp;amp;gt;)集合完成注解解析&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#0000FF;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3380\&quot; y=\&quot;1934.25\&quot; width=\&quot;1810\&quot; height=\&quot;585.75\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-29\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FF0000;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-24\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-28\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-1\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#FFFF33;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-24\&quot; target=\&quot;HpXuxDKBIxLuHr3aR9rR-0\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-24\&quot; value=\&quot;同样是对 BeanDefintion 所属类的判断相同：&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;首先判断 BeanDefinition 是否是注解类 AnnotationMetadata；然后调用&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#parse(org.springframework.core.type.AnnotationMetadata, java.lang.String) 完成解析&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;如果不是判断 BeanDefinition 是否是普通类 AbstractBeanDefinition，则调用&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#parse(org.springframework.core.type.AnnotationMetadata, java.lang.String) 完成解析&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;如果都不属于，则调用&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#parse(java.lang.String, java.lang.String) 完成解析；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;处理在 org.springframework.context.annotation.ConfigurationClassParser#processImports 添加的类的处理逻辑：this.deferredImportSelectorHandler.process();（处理自动加载的逻辑）&amp;lt;/font&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;div&amp;gt;因为分析的是注解解析，所以按照注解的方法来分析&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#00CC00;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;5870\&quot; y=\&quot;2520\&quot; width=\&quot;1670\&quot; height=\&quot;430\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-32\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FFFF33;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-28\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-31\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-28\&quot; value=\&quot;parse 方法中调用了 processConfigurationClass 完成解析&amp;lt;br&amp;gt;org.springframework.context.annotation.ConfigurationClassParser#processConfigurationClass&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;判断当前&amp;amp;nbsp;configClass 是否跳过解析：org.springframework.context.annotation.ConditionEvaluator#shouldSkip(org.springframework.core.type.AnnotatedTypeMetadata, org.springframework.context.annotation.ConfigurationCondition.ConfigurationPhase)&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;调用&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#doProcessConfigurationClass 开始解析；&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;将解析完成的 configClass 放入&amp;amp;nbsp;configurationClasses 集合中；&amp;amp;nbsp;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;7920\&quot; y=\&quot;2254.75\&quot; width=\&quot;1510\&quot; height=\&quot;291\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-0\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassParser.DeferredImportSelectorHandler#process&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;org.springframework.context.annotation.ConfigurationClassParser.DeferredImportSelectorGroupingHandler#processGroupImports：调用该方法获取配置类信息——》grouping.getImports()——》org.springframework.context.annotation.DeferredImportSelector.Group#process 实现该方法完成自动配置类的加载(SpringBoot 中 EnableAutoConfiguration 类中实现了该方法，完成 SpringBoot 中的一些类的自动加载)&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF33;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;7920\&quot; y=\&quot;2900\&quot; width=\&quot;1550\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-3\&quot; value=\&quot;\&quot; style=\&quot;group\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;5620\&quot; y=\&quot;1075.62\&quot; width=\&quot;1850\&quot; height=\&quot;892.3399999999999\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-4\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassUtils#checkConfigurationClassCandidate：&amp;lt;br&amp;gt;这个类型判断就可以参考上述的 BeanDefinition 分支。&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;amp;nbsp;获取 BeanDefinition 名称，为 null 则返回 false；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;首先判断 BeanDefinition 是否是注解类 AnnotationMetadata：反之，判断该 BeanDefinition 是否属于&amp;amp;nbsp;AnnotationMetadata 类型；(通过注解注入的类都属于 AnnotationMetadata，因为因为该接口继承了 BeanDefinition 接口)，且 bean 名称与 AnnotationMetadata获取的 bean 名称是否相同：相同则从 AnnotationMetadata 中获取&amp;amp;nbsp;metadata 数据元信息&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;如果不属于 AnnotationMetadata， 则判断 BeanDefinition 是否属于 AbstractBeanDefinition；如果属于，则获取当前对象的 class 对象，并判断该对象是否属于指定的几种类型，如果不是根据 beanClass 生成对应的 AnnotationMetadata；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;如果不属于 AnnotationMetadata，也不属于 AbstractBeanDefinition，则直接获取元数据读取器，利用原数据读取器获取元数据信息；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;判断注解是否是 Configuration 注解，如果是，则给 BeanDefinition 的 attribute 设置属性值：full&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;反之如果包含&amp;amp;nbsp;@Bean，@ComponentScan, @Import @ImportSource 注解，则设置属性为：lite；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;注解类是否添加了 @Order 注解，获取 Order 注解的值，给BeanDefinition 设置 order 属性；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;最终返回 true；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-3\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;250\&quot; y=\&quot;365.9255855855856\&quot; width=\&quot;1180\&quot; height=\&quot;526.4144144144144\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; value=\&quot;\&quot; style=\&quot;group\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-3\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry width=\&quot;1850\&quot; height=\&quot;350.5899999999999\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-9\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;BeanDefinition 接口&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry y=\&quot;108.58999999999992\&quot; width=\&quot;225\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-12\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: start;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;RootBeanDefinition&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;450\&quot; width=\&quot;245\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-9\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-12\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-16\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;GenericBeanDefinition&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;450\&quot; y=\&quot;213.17999999999984\&quot; width=\&quot;255\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-7\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-9\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-16\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-8\&quot; value=\&quot;实现类\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=25;\&quot; parent=\&quot;RU2fjSCJP_jP4QLkFLcv-7\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.7116\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-18\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 24px;&amp;quot;&amp;gt;ScannedGenericBeanDefinition&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;rounded=0;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;960\&quot; y=\&quot;142.34000000000015\&quot; width=\&quot;370\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-16\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-18\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-19\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;AnnotatedBeanDefinition&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;rounded=0;fontColor=#000000;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1542\&quot; y=\&quot;223.75\&quot; width=\&quot;308\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-17\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;实现接口&amp;lt;/font&amp;gt;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-18\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-19\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-20\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-22\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-19\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-21\&quot; value=\&quot;实现接口\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=25;\&quot; parent=\&quot;RU2fjSCJP_jP4QLkFLcv-20\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;0.0481\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint y=\&quot;12\&quot; as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-22\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;AnnotatedGenericBeanDefinition&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;rounded=0;fontColor=#000000;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;960\&quot; y=\&quot;287.16999999999985\&quot; width=\&quot;370\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-14\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-16\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-22\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-15\&quot; value=\&quot;继承类\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=25;\&quot; parent=\&quot;RU2fjSCJP_jP4QLkFLcv-14\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.7813\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint x=\&quot;19\&quot; as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-23\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 25px;&amp;quot;&amp;gt;ConfigurationClassBeanDefinition&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;gradientColor=#97d077;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;880\&quot; width=\&quot;410\&quot; height=\&quot;63.42\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-10\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;\&quot; parent=\&quot;HpXuxDKBIxLuHr3aR9rR-2\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-12\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-23\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-11\&quot; value=\&quot;继承类\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=25;\&quot; parent=\&quot;RU2fjSCJP_jP4QLkFLcv-10\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;-0.0692\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;&lt;mxPoint as=\&quot;offset\&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;SYowd_BIEG6JtQlyVp_6-3\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;HpXuxDKBIxLuHr3aR9rR-5\&quot; target=\&quot;SYowd_BIEG6JtQlyVp_6-2\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;HpXuxDKBIxLuHr3aR9rR-5\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;org.springframework.context.support.AbstractApplicationContext#registerBeanPostProcessors：实例化并注册所有 BeanPostProcessor bean&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false)：找到所有实现 BeanPostProcessor 接口的类&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;BeanPostProcessor 的目标计数+1: beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length;&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;添加 BeanPostProcessorChecker (主要用于记录信息) 到 beanFactory 中：beanFactory.addBeanPostProcessor(new BeanPostProcessorChecker(beanFactory, beanProcessorTargetCount));：该类实现了 BeanPostProcessor 接口：该类实现的处理器方法如下：&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;该类后置处理器前置方法：postProcessBeforeInitialization 直接返回 bean；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;该类后置处理器后置方法：postProcessAfterInitialization 对 bean 的角色进行记录，只是输出了日志，没有逻辑处理；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;定义存放实现了不同接口的集合，以及存放实现对应接口 bean 名称的集合：priorityOrderedPostProcessors、internalPostProcessors、orderedPostProcessorNames、nonOrderedPostProcessorNames；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;遍历循环实现 BeanPostProcessor 接口的 Bean，然后判断 Bean 的类型，将 Bean 放入不同的集合中&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;beanFactory.isTypeMatch(ppName, PriorityOrdered.class)——》priorityOrderedPostProcessors.add(pp);&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;bean 还实现了 PriorityOrdered 接口，则：&amp;amp;nbsp;pp instanceof MergedBeanDefinitionPostProcessor——》internalPostProcessors.add(pp); 将该 bean 实例添加到 internalPostProcessors 集合中；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;对 bean 实例排序，然后将其添加到 BeanFactory 中；registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;beanFactory.isTypeMatch(ppName, Ordered.class——》orderedPostProcessorNames.add(ppName);&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;如果 bean 实例还是实现了 MergedBeanDefinitionPostProcessor，将其添加到 internalPostProcessors 集合中；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;遍历循环 orderedPostProcessorNames 集合，获取对应的实例，排完序之后，将其添加到 BeanFactory 中；registerBeanPostProcessors(beanFactory, orderedPostProcessors);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;如果不属于上述两种接口类型，则：nonOrderedPostProcessorNames.add(ppName);&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;如果 bean 实例还是实现了 MergedBeanDefinitionPostProcessor，将其添加到 internalPostProcessors 集合中；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;遍历循环 nonOrderedPostProcessorNames&amp;amp;nbsp;集合，获取对应的实例，排完序之后，将其添加到 BeanFactory 中；registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors);&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;相关接口的解释：&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;BeanPostProcessor：bean 初始化前后的时候会调用该接口的方法：postProcessBeforeInitialization、postProcessAfterInitialization；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;DestructionAwareBeanPostProcessor：bean 销毁的时候会调用该接口的方法：postProcessBeforeDestruction；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;InstantiationAwareBeanPostProcessor： bean 实例化前后需要做的事情：postProcessBeforeInstantiation、postProcessAfterInstantiation；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;SmartInstantiationAwareBeanPostProcessor：bean 的类型推断、构造器推断、bean 实例化循环依赖的解决：predictBeanType、determineCandidateConstructors、getEarlyBeanReference；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;对实现了 MergedBeanDefinitionPostProcessor 的 bean 实例进行排序，然后添加到 BeanFactory 中；registerBeanPostProcessors(beanFactory, internalPostProcessors);&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;amp;nbsp;重新注册用于将内部 bean 检测为 ApplicationListeners 的后处理器：beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;rounded=0;strokeWidth=1;fontColor=#FFFF33;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-1275\&quot; y=\&quot;1739.62\&quot; width=\&quot;2240\&quot; height=\&quot;830.38\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; value=\&quot;\&quot; style=\&quot;group\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot;&gt;&lt;mxGeometry x=\&quot;9720\&quot; y=\&quot;1960\&quot; width=\&quot;4465\&quot; height=\&quot;1400\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-31\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassParser#doProcessConfigurationClass&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;递归处理配置类的内部配置类：调用&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#processMemberClasses 属于方法外递归处理，在processMemberClasses方法中又调用了&amp;amp;nbsp;org.springframework.context.annotation.ConfigurationClassParser#processConfigurationClass；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;遍历循环解析 @PropertySource 注解(PropertySource 可以指定多个配置文件)；并将配置文件的属性信息放入environment-》propertySourceList 中；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;解析 @ComponentScan 注解，对 @ComponentScan 注解的属性值进行解析：org.springframework.context.annotation.ComponentScanAnnotationParser#parse&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;判断解析之后的的 BeanDefinition&amp;amp;nbsp; 的类是否还包含了 @ComponentScan 等注解，如果包含需要再次递归处理；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#00cc00&amp;quot;&amp;gt;处理 @Import 注解：processImports(configClass, sourceClass, getImports(sourceClass), filter, true);&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;处理 @ImportSource 导入的配置文件；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;处理添加了 @Bean 注解的方法；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;处理接口默认的方法实现。从JDK8开始，接口可以有自己的方法实现；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;解析配置的父类，如果配置类继承了某个父类，那么配置类的父类也会被解析；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF33;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry y=\&quot;178.1199999999999\&quot; width=\&quot;1510\&quot; height=\&quot;524\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-33\&quot; value=\&quot;org.springframework.context.annotation.ComponentScanAnnotationParser#parse&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;创建 bean 定义的扫描器；ClassPathBeanDefinitionScanner scanner&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;获取 bean 的名称生成器，判断是自定义还是默认的；然后为&amp;amp;nbsp;&amp;lt;/span&amp;gt;scanner 设置 bean 名称生成器的属性；&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 bean 的代理模式，并设置对应的代理模式。它的作用是对生命周期短的bean提供装饰，使其能被生命周期长的bean正确调用；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;设置扫描类路径时使用的资源路径；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 @ComponentScan 注解中&amp;amp;nbsp;includeFilters 属性，明确要扫描的路径；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 @ComponentScan 注解中&amp;amp;nbsp;excludeFilters 属性，明确不需要扫描的路径；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 lazyInit 属性，哪些 beanDefinition 需要懒加载；&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 basePackages 属性，确定需要扫描的包路径；&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;获取 basePackages 属性，指定某个类的包的路径进行扫描；&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;调用&amp;amp;nbsp;org.springframework.context.annotation.ClassPathBeanDefinitionScanner#doScan 完成指定包路径下类的扫描；&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1900\&quot; width=\&quot;1250\&quot; height=\&quot;457\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-37\&quot; value=\&quot;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ff0000&amp;quot;&amp;gt;org.springframework.context.annotation.ConfigurationClassParser#getImports：通过 getImports 获取所有 Import 注解的类&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;org.springframework.context.annotation.ConfigurationClassParser#processImports&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#00CC00;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1900\&quot; y=\&quot;548\&quot; width=\&quot;1239\&quot; height=\&quot;192\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-39\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassParser#getImports&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;Set&amp;amp;lt;SourceClass&amp;amp;gt; imports = new LinkedHashSet&amp;amp;lt;&amp;amp;gt;(): 创建集合，存储包含 @Import 注解的类&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;Set&amp;amp;lt;SourceClass&amp;amp;gt; visited = new LinkedHashSet&amp;amp;lt;&amp;amp;gt;();&amp;amp;nbsp;创建集合，为了实现递归调用，存放递归关系&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;font color=&amp;quot;#ffff33&amp;quot;&amp;gt;调用&amp;amp;nbsp;collectImports(sourceClass, imports, visited); 开始解析包含 @Import 注解的类&amp;lt;/font&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FF0000;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3260\&quot; y=\&quot;539\&quot; width=\&quot;1200\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-41\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassParser#processImports&amp;lt;br&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;判断 @Import 注解集合是否为空，如果为空则直接返回；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;通过栈结构处理循环引入或者链式引入的问题；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;将注解类放入栈中，开始遍历循环 @Import 注解类的集合：importCandidates；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;判断集合中的类是否实现了 ImportSelector 接口，如果是，通过反射生成 ImportSelector 实例；&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;查看 selector 是否有过滤器；&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;判断是否是实现了 DeferredImportSelector 接口的 selector，则用deferredImportSelectorHandler 处理，&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;不是实现了 DeferredImportSelector 接口的类， 调用selectImports方法获取要加载的类全限定名称，递归调用本方法继续解析&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;反之 添加到 deferredImportSelectors 集合中，&amp;amp;nbsp;this.deferredImportSelectors.add(holder)；在处理完所有配置类注解后，再处理 deferredImportSelectors 的逻辑：this.deferredImportSelectorHandler.process();&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;li&amp;gt;判断集合中的类是否实现了 deferredImportSelectors&amp;amp;nbsp;&amp;amp;nbsp;接口，如果是，通过反射生成 ImportBeanDefinitionRegistrar 实例；&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;如果集合中的类两者都没有实现，处理@Configuration注解类，或者是普通类（直接生成Bean）&amp;lt;/li&amp;gt;&amp;lt;ol&amp;gt;&amp;lt;li&amp;gt;递归回到doProcessConfigurationClass处理@Configuration注解类&amp;lt;br&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ol&amp;gt;&amp;lt;/ol&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF33;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1914.5\&quot; y=\&quot;840\&quot; width=\&quot;1210\&quot; height=\&quot;560\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-43\&quot; value=\&quot;org.springframework.context.annotation.ConfigurationClassParser#collectImports：主要功能就是递归收集包含 @Import 注解类(递归那些嵌套的 @Import 注解)\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#FFFF33;strokeColor=#82b366;rounded=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;3255\&quot; y=\&quot;835.6199999999999\&quot; width=\&quot;1210\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-34\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FF0000;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-31\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-33\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-38\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#00CC00;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-31\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-37\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-40\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FF0000;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-37\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-39\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-42\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FFFF33;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-37\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-41\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;RU2fjSCJP_jP4QLkFLcv-44\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#FFFF33;\&quot; parent=\&quot;SYowd_BIEG6JtQlyVp_6-1\&quot; source=\&quot;RU2fjSCJP_jP4QLkFLcv-39\&quot; target=\&quot;RU2fjSCJP_jP4QLkFLcv-43\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;SYowd_BIEG6JtQlyVp_6-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=5;fontColor=#000000;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; source=\&quot;SYowd_BIEG6JtQlyVp_6-2\&quot; target=\&quot;SYowd_BIEG6JtQlyVp_6-4\&quot; edge=\&quot;1\&quot;&gt;&lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;SYowd_BIEG6JtQlyVp_6-2\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;initMessageSource：国际化的操作，即不同的语言(不做深入研究)&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#FFFF33;rounded=0;strokeWidth=1;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-377.5\&quot; y=\&quot;2680.62\&quot; width=\&quot;445\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;SYowd_BIEG6JtQlyVp_6-4\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;初始化监听器：initApplicationEventMulticaster：知道观察者模式就行：Spring 对观察者模式的实现：&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;1. 事件：被观察者具体要执行的动作；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2. 监听器：观察者，可能存在多个，接收不同的事件来做不同的处理工作；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3. 多播器：把被观察者遍历观察者通知消息的操作拿出来委托给一个多播器来进行消息通知，或者说通过观察者进行不同的操作；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;4. 事件源：谁来调用或者执行发布具体的事件；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Spring 观察者的执行流程：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;1. 事件源来发布不同的事件；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2. 当发布事件之后会调用多播器的方法来进行事件的广播操作，由多播器触发具体的监听器去执行操作；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3. 监听器接收到具体的事件之后，可以验证匹配是否能处理当前事件。如果可以，直接处理。如果不行，则不做任何操作；&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;fontSize=25;align=left;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#FFFF33;rounded=0;strokeWidth=1;\&quot; parent=\&quot;WIyWlLk6GJQsqaUBKTNV-1\&quot; vertex=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;-883.76\&quot; y=\&quot;2852.12\&quot; width=\&quot;1457.5\&quot; height=\&quot;337.88\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div>
<a style="position:absolute;top:50%;left:50%;margin-top:-128px;margin-left:-64px;" href="https://app.diagrams.net/#Han-1024%2FWorkUtil%2Fmaster%2Futilsdemo%2Fsrc%2Fmain%2Fresources%2FFlowDiagram%2FSpring_IOC_%E7%BB%86%E8%8A%82.drawio.html" target="_blank"><img border="0" src="https://app.diagrams.net/images/drawlogo128.png"/></a>
</body>
</html>
